{
  "run_id": "new_milestone-mltzeogc-5150a7",
  "tool_name": "gsd_new_milestone",
  "workflow_file": "new-milestone.md",
  "workflow_args": {
    "name": "Self-Extension Hardening: GitHub + Sandbox"
  },
  "created_at": "2026-02-19T21:37:09.709Z",
  "updated_at": "2026-02-19T21:37:09.715Z",
  "status": "active",
  "next_step": 1,
  "total_steps": 6,
  "preamble": "<arguments>\n{\n  \"name\": \"Self-Extension Hardening: GitHub + Sandbox\"\n}\n</arguments>\n\n<mcp_safe_execution>\nSubagent delegation is not available in many MCP clients.\nExecute every single-agent step directly in this same session.\nUse intermediate files as handoff boundaries between passes to preserve context quality.\nIf original text mentions \"spawn\" or \"subagent\", interpret it as \"run the next pass yourself\".\n</mcp_safe_execution>\n\n<next_step_policy>\nAfter completing EACH major step, your response MUST end with a line:\nNext on list: <exact next command/tool and args>\nDo not end a step response without this line.\nAfter workflow completion: Next on list -> call gsd_discuss_phase for the first unfinished roadmap phase.\n</next_step_policy>\n\n<purpose>\n\nStart a new milestone cycle for an existing project. Loads project context, gathers milestone goals (from MILESTONE-CONTEXT.md or conversation), updates PROJECT.md and STATE.md, optionally runs split research passes, defines scoped requirements with REQ-IDs, runs the roadmapper to create phased execution plan, and commits all artifacts. Brownfield equivalent of new-project.\n\n</purpose>\n\n<required_reading>\n\nRead all files referenced by the invoking prompt's execution_context before starting.\n\n</required_reading>\n\n<process>\n\n## 1. Load Context\n\n- Read PROJECT.md (existing project, validated requirements, decisions)\n- Read MILESTONES.md (what shipped previously)\n- Read STATE.md (pending todos, blockers)\n- Check for MILESTONE-CONTEXT.md (from the `gsd_discuss_phase` tool or manual creation)\n\n## 2. Gather Milestone Goals\n\n**If MILESTONE-CONTEXT.md exists:**\n- Use features and scope from discuss-milestone\n- Present summary for confirmation\n\n**If no context file:**\n- Present what shipped in last milestone\n- Ask: \"What do you want to build next?\"\n- Use prompt_user to explore features, priorities, constraints, scope\n\n## 3. Determine Milestone Version\n\n- Parse last version from MILESTONES.md\n- Suggest next version (v1.0 → v1.1, or v2.0 for major)\n- Confirm with user\n\n## 4. Update PROJECT.md\n\nAdd/update:\n\n```markdown\n## Current Milestone: v[X.Y] [Name]\n\n**Goal:** [One sentence describing milestone focus]\n\n**Target features:**\n- [Feature 1]\n- [Feature 2]\n- [Feature 3]\n```\n\nUpdate Active requirements section and \"Last updated\" footer.\n\n## 5. Update STATE.md\n\n```markdown\n## Current Position\n\nPhase: Not started (defining requirements)\nPlan: —\nStatus: Defining requirements\nLast activity: [today] — Milestone v[X.Y] started\n```\n\nKeep Accumulated Context section from previous milestone.\n\n## 6. Cleanup and Commit\n\nDelete MILESTONE-CONTEXT.md if exists (consumed).\n\nCall the `gsd_commit_work` tool with `{ \"message\": \"docs: start milestone v[X.Y] [Name]\", \"files\": \".planning/PROJECT.md .planning/STATE.md\" }`.\n\n## 7. Load Context and Resolve Models\n\nCall the `gsd_init_new_milestone` tool. Parse the returned JSON for: `researcher_model`, `synthesizer_model`, `roadmapper_model`, `commit_docs`, `research_enabled`, `current_milestone`, `project_exists`, `roadmap_exists`.\n\n## 8. Research Decision\n\n<prompt_user>\n  <question header=\"Research\">Research the domain ecosystem for new features before defining requirements?</question>\n  <option label=\"Research first (Recommended)\">Discover patterns, features, architecture for NEW capabilities</option>\n  <option label=\"Skip research\">Go straight to requirements</option>\n</prompt_user>\n\n**Persist choice to config** (so future `gsd_plan_phase` tool calls honor it):\n\nIf \"Research first\": Call the `gsd_config_set` tool with `{ \"key\": \"workflow.research\", \"value\": \"true\" }`.\n\nIf \"Skip research\": Call the `gsd_config_set` tool with `{ \"key\": \"workflow.research\", \"value\": \"false\" }`.\n\n**If \"Research first\":**\n\n```\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n GSD ► RESEARCHING\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n◆ Running research passes (one fresh agent per pass)...\n  → 1) Stack  2) Features  3) Architecture  4) Pitfalls\n```\n\n```bash\nmkdir -p .planning/research\n```\n\nRun research as separate delegated passes (one pass per fresh agent in split-session mode):\n\n**Pass 1: Stack research**\n```",
  "epilogue": "```\n\n**Handle return:**\n\n**If `## ROADMAP BLOCKED`:** Present blocker, work with user, then run the roadmap step again.\n\n**If `## ROADMAP CREATED`:** Read ROADMAP.md, present inline:\n\n```\n## Proposed Roadmap\n\n**[N] phases** | **[X] requirements mapped** | All covered ✓\n\n| # | Phase | Goal | Requirements | Success Criteria |\n|---|-------|------|--------------|------------------|\n| [N] | [Name] | [Goal] | [REQ-IDs] | [count] |\n\n### Phase Details\n\n**Phase [N]: [Name]**\nGoal: [goal]\nRequirements: [REQ-IDs]\nSuccess criteria:\n1. [criterion]\n2. [criterion]\n```\n\n**Ask for approval** via prompt_user:\n\n<prompt_user>\n  <question header=\"Roadmap\">Does this roadmap structure work for you?</question>\n  <option label=\"Approve\">Commit and continue</option>\n  <option label=\"Adjust phases\">Tell me what to change</option>\n  <option label=\"Review full file\">Show raw ROADMAP.md</option>\n</prompt_user>\n\n**If \"Adjust\":** Get notes, run roadmapper again with revision context, loop until approved.\n**If \"Review\":** Display raw ROADMAP.md, re-ask.\n\n**Commit roadmap** (after approval):\n\nCall the `gsd_commit_work` tool with `{ \"message\": \"docs: create milestone v[X.Y] roadmap ([N] phases)\", \"files\": \".planning/ROADMAP.md .planning/STATE.md .planning/REQUIREMENTS.md\" }`.\n\n## 11. Done\n\n```\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n GSD ► MILESTONE INITIALIZED ✓\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n**Milestone v[X.Y]: [Name]**\n\n| Artifact       | Location                    |\n|----------------|-----------------------------|\n| Project        | `.planning/PROJECT.md`      |\n| Research       | `.planning/research/`       |\n| Requirements   | `.planning/REQUIREMENTS.md` |\n| Roadmap        | `.planning/ROADMAP.md`      |\n\n**[N] phases** | **[X] requirements** | Ready to build ✓\n\n## ▶ Next Up\n\n**Phase [N]: [Phase Name]** — [Goal]\n\nCall the `gsd_discuss_phase` tool with `{ \"phase\": \"[N]\" }` — gather context and clarify approach\n\n<sub>Start a fresh conversation for best results</sub>\n\nAlso: Call the `gsd_plan_phase` tool with `{ \"phase\": \"[N]\" }` — skip discussion, plan directly\n```\n\n</process>\n\n<success_criteria>\n- [ ] PROJECT.md updated with Current Milestone section\n- [ ] STATE.md reset for new milestone\n- [ ] MILESTONE-CONTEXT.md consumed and deleted (if existed)\n- [ ] Research completed (if selected) — 4 separate passes, milestone-aware\n- [ ] Requirements gathered and scoped per category\n- [ ] REQUIREMENTS.md created with REQ-IDs\n- [ ] gsd-roadmapper run with phase numbering context\n- [ ] Roadmap files written immediately (not draft)\n- [ ] User feedback incorporated (if any)\n- [ ] ROADMAP.md phases continue from previous milestone\n- [ ] All commits made (if planning docs committed)\n- [ ] User knows next step: Call the `gsd_discuss_phase` tool with `{ \"phase\": \"[N]\" }`\n\n**Atomic commits:** Each phase commits its artifacts immediately.\n</success_criteria>\n</output>",
  "steps": [
    {
      "number": "1",
      "content": "<single_agent_step number=\"1\">\nExecute this pass directly in the current conversation (MCP-safe mode: no delegated call).\nOriginal delegated task: Stack research\n\n<task_prompt>\n<research_type>Project Research — Stack for [new features].</research_type>\n\n    <milestone_context>\n    SUBSEQUENT MILESTONE — Adding [target features] to existing app.\n    Existing validated capabilities (DO NOT re-research): [from PROJECT.md]\n    Focus ONLY on what's needed for the NEW features.\n    </milestone_context>\n\n    <question>What stack additions/changes are needed for [new features]?</question>\n\n    <project_context>[PROJECT.md summary]</project_context>\n\n    <downstream_consumer>\n    Specific libraries with versions for NEW capabilities, integration points, what NOT to add\n    </downstream_consumer>\n\n    <quality_gate>\n    - [ ] Versions current (verify with Context7)\n    - [ ] Rationale explains WHY each addition is needed\n    - [ ] Integration with existing system considered\n    </quality_gate>\n\n    <output>\n    Write to: .planning/research/STACK.md\n    Use template: ~/.claude/get-shit-done/templates/research-project/STACK.md\n    </output>\n</task_prompt>\n\nAfter completion: keep the same completion markers expected by the workflow and continue.\n</single_agent_step>"
    },
    {
      "number": "2",
      "content": "<single_agent_step number=\"2\">\nExecute this pass directly in the current conversation (MCP-safe mode: no delegated call).\nOriginal delegated task: Features research\n\n<task_prompt>\n<research_type>Project Research — Features for [new features].</research_type>\n\n    <milestone_context>\n    SUBSEQUENT MILESTONE — Adding [target features] to existing app.\n    Existing features (already built): [from PROJECT.md]\n    Focus ONLY on what's needed for the NEW features.\n    </milestone_context>\n\n    <question>How do [target features] typically work? What behavior is expected?</question>\n\n    <project_context>[PROJECT.md summary]</project_context>\n\n    <downstream_consumer>\n    Table stakes vs differentiators vs anti-features, complexity noted, dependencies on existing system\n    </downstream_consumer>\n\n    <quality_gate>\n    - [ ] Feature categories are clear and actionable\n    - [ ] Complexity and dependencies are explicit\n    - [ ] Recommendations fit milestone scope\n    </quality_gate>\n\n    <output>\n    Write to: .planning/research/FEATURES.md\n    Use template: ~/.claude/get-shit-done/templates/research-project/FEATURES.md\n    </output>\n</task_prompt>\n\nAfter completion: keep the same completion markers expected by the workflow and continue.\n</single_agent_step>"
    },
    {
      "number": "3",
      "content": "<single_agent_step number=\"3\">\nExecute this pass directly in the current conversation (MCP-safe mode: no delegated call).\nOriginal delegated task: Architecture research\n\n<task_prompt>\n<research_type>Project Research — Architecture for [new features].</research_type>\n\n    <milestone_context>\n    SUBSEQUENT MILESTONE — Adding [target features] to existing app.\n    Existing architecture: [from PROJECT.md or codebase map]\n    Focus ONLY on what's needed for the NEW features.\n    </milestone_context>\n\n    <question>How should [target features] integrate with existing architecture?</question>\n\n    <project_context>[PROJECT.md summary]</project_context>\n\n    <downstream_consumer>\n    Integration points, new components, data flow changes, suggested build order\n    </downstream_consumer>\n\n    <quality_gate>\n    - [ ] New vs modified components identified\n    - [ ] Integration points are concrete\n    - [ ] Build order accounts for dependencies\n    </quality_gate>\n\n    <output>\n    Write to: .planning/research/ARCHITECTURE.md\n    Use template: ~/.claude/get-shit-done/templates/research-project/ARCHITECTURE.md\n    </output>\n</task_prompt>\n\nAfter completion: keep the same completion markers expected by the workflow and continue.\n</single_agent_step>"
    },
    {
      "number": "4",
      "content": "<single_agent_step number=\"4\">\nExecute this pass directly in the current conversation (MCP-safe mode: no delegated call).\nOriginal delegated task: Pitfalls research\n\n<task_prompt>\n<research_type>Project Research — Pitfalls for [new features].</research_type>\n\n    <milestone_context>\n    SUBSEQUENT MILESTONE — Adding [target features] to existing app.\n    Focus on common mistakes when ADDING these features to an existing system.\n    </milestone_context>\n\n    <question>What common mistakes happen when adding [target features] to [domain]?</question>\n\n    <project_context>[PROJECT.md summary]</project_context>\n\n    <downstream_consumer>\n    Warning signs, prevention strategy, and which phase should address each pitfall\n    </downstream_consumer>\n\n    <quality_gate>\n    - [ ] Pitfalls are specific to incremental feature addition\n    - [ ] Integration pitfalls are covered\n    - [ ] Prevention guidance is actionable\n    </quality_gate>\n\n    <output>\n    Write to: .planning/research/PITFALLS.md\n    Use template: ~/.claude/get-shit-done/templates/research-project/PITFALLS.md\n    </output>\n</task_prompt>\n\nAfter completion: keep the same completion markers expected by the workflow and continue.\n</single_agent_step>"
    },
    {
      "number": "5",
      "content": "<single_agent_step number=\"5\">\nExecute this pass directly in the current conversation (MCP-safe mode: no delegated call).\nOriginal delegated task: Synthesize research\n\n<task_prompt>\nSynthesize research outputs into SUMMARY.md.\n\n    Read: .planning/research/STACK.md, FEATURES.md, ARCHITECTURE.md, PITFALLS.md\n\n    Write to: .planning/research/SUMMARY.md\n    Use template: ~/.claude/get-shit-done/templates/research-project/SUMMARY.md\n    Commit after writing.\n</task_prompt>\n\nAfter completion: keep the same completion markers expected by the workflow and continue.\n</single_agent_step>"
    },
    {
      "number": "6",
      "content": "<single_agent_step number=\"6\">\nExecute this pass directly in the current conversation (MCP-safe mode: no delegated call).\nOriginal delegated task: Create roadmap\n\n<task_prompt>\n<planning_context>\n    @.planning/PROJECT.md\n    @.planning/REQUIREMENTS.md\n    @.planning/research/SUMMARY.md (if exists)\n    @.planning/config.json\n    @.planning/MILESTONES.md\n    </planning_context>\n\n    <instructions>\n    Create roadmap for milestone v[X.Y]:\n    1. Start phase numbering from [N]\n    2. Derive phases from THIS MILESTONE's requirements only\n    3. Map every requirement to exactly one phase\n    4. Derive 2-5 success criteria per phase (observable user behaviors)\n    5. Validate 100% coverage\n    6. Write files immediately (ROADMAP.md, STATE.md, update REQUIREMENTS.md traceability)\n    7. Return ROADMAP CREATED with summary\n\n    Write files first, then return.\n    </instructions>\n</task_prompt>\n\nAfter completion: keep the same completion markers expected by the workflow and continue.\n</single_agent_step>"
    }
  ],
  "history": []
}